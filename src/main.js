"use strict";var wt=Object.create;var Ee=Object.defineProperty;var St=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var Ct=Object.getPrototypeOf,Et=Object.prototype.hasOwnProperty;var Pt=(d,a)=>()=>(a||d((a={exports:{}}).exports,a),a.exports),Tt=(d,a)=>{for(var y in a)Ee(d,y,{get:a[y],enumerable:!0})},Je=(d,a,y,f)=>{if(a&&typeof a=="object"||typeof a=="function")for(let x of kt(a))!Et.call(d,x)&&x!==y&&Ee(d,x,{get:()=>a[x],enumerable:!(f=St(a,x))||f.enumerable});return d};var Ot=(d,a,y)=>(y=d!=null?wt(Ct(d)):{},Je(a||!d||!d.__esModule?Ee(y,"default",{value:d,enumerable:!0}):y,d)),It=d=>Je(Ee({},"__esModule",{value:!0}),d);var xt=Pt((Zi,bt)=>{"use strict";var Lt=Object.create,Ie=Object.defineProperty,Nt=Object.getOwnPropertyDescriptor,jt=Object.getOwnPropertyNames,Ut=Object.getPrototypeOf,Mt=Object.prototype.hasOwnProperty,F=(d,a)=>()=>(a||d((a={exports:{}}).exports,a),a.exports),At=(d,a)=>{for(var y in a)Ie(d,y,{get:a[y],enumerable:!0})},st=(d,a,y,f)=>{if(a&&typeof a=="object"||typeof a=="function")for(let x of jt(a))!Mt.call(d,x)&&x!==y&&Ie(d,x,{get:()=>a[x],enumerable:!(f=Nt(a,x))||f.enumerable});return d},ne=(d,a,y)=>(y=d!=null?Lt(Ut(d)):{},st(a||!d||!d.__esModule?Ie(y,"default",{value:d,enumerable:!0}):y,d)),Rt=d=>st(Ie({},"__esModule",{value:!0}),d),ot=F((d,a)=>{"use strict";var y=Object.create,f=Object.defineProperty,x=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,r=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,e=(p,w)=>{for(var g in w)f(p,g,{get:w[g],enumerable:!0})},i=(p,w,g,n)=>{if(w&&typeof w=="object"||typeof w=="function")for(let E of m(w))!h.call(p,E)&&E!==g&&f(p,E,{get:()=>w[E],enumerable:!(n=x(w,E))||n.enumerable});return p},l=(p,w,g)=>(g=p!=null?y(r(p)):{},i(w||!p||!p.__esModule?f(g,"default",{value:p,enumerable:!0}):g,p)),o=p=>i(f({},"__esModule",{value:!0}),p),c={};e(c,{ChatType:()=>s,MsgType:()=>S,SendType:()=>u,r:()=>t}),a.exports=o(c);var C=l(require("node:path")),_=()=>{let p={"payload/sendMsg":{msgId:"0",elements:[]},"peer/private":{chatType:1,guildId:"",peerUid:"",peerUin:""},"peer/group":{chatType:2,guildId:"",peerUid:"",peerUin:""}},w=(g,n)=>Object.assign({},p[g],n);return Object.defineProperties(w,Object.fromEntries(Object.entries({reg:p,peerPrivate:g=>w("peer/private",{peerUin:g}),peerGroup:g=>w("peer/group",{peerUin:g}),text:g=>({elementId:"",elementType:1,textElement:{content:g,atUid:"",atNtUid:"",atTinyUid:"",atType:0}}),at:(g,n)=>({elementId:"",elementType:1,textElement:{content:`@${g}`,atUid:n==="all"?"all":"",atNtUin:n==="all"?void 0:n,atNtUid:n==="all"?"all":void 0,atTinyUid:"",atType:n==="all"?1:2}}),remoteImage:(g,n)=>({elementId:"",elementType:2,extBufForUI:"",picElement:{fileName:C.default.basename(g.ntFilePath),fileSize:String(g.fileSize),fileSubId:"",fileUuid:"",md5HexStr:g.md5,original:!0,picHeight:g.imageInfo.height,picWidth:g.imageInfo.width,picType:n,picSubType:0,sourcePath:g.ntFilePath,summary:"",thumbFileSize:0}})}).map(([g,n])=>[g,{value:n}])))},t=_(),s=(p=>(p[p.Private=1]="Private",p[p.Group=2]="Group",p))(s||{}),S=(p=>(p[p.Normal=2]="Normal",p[p.Value3=3]="Value3",p[p.System=5]="System",p[p.Ptt=6]="Ptt",p[p.Video=7]="Video",p[p.Value8=8]="Value8",p[p.WithRecords=9]="WithRecords",p[p.Wallet=10]="Wallet",p[p.Ark=11]="Ark",p[p.Vaule17=17]="Vaule17",p))(S||{}),u=(p=>(p[p.Normal=0]="Normal",p[p.System=3]="System",p))(u||{})}),Bt=F((d,a)=>{"use strict";function y(m,r,h="  ",e=""){return i(m,r,h===!1?"":h,e,[]);function i(l,o,c,C,_){let t=C+c;switch(l=o?o(l):l,typeof l){case"string":return JSON.stringify(l);case"number":return Object.is(l,-0)?"-0":String(l);case"boolean":case"undefined":return String(l);case"function":return l.toString()}if(l===null)return"null";if(l instanceof RegExp)return l.toString();if(l instanceof Date)return`new Date(${l.getTime()})`;if(l instanceof Set)return`new Set(${i(Array.from(l.values()),o,c,t,_)})`;if(l instanceof Map)return`new Map(${i(Array.from(l.entries()),o,c,t,_)})`;if(_.indexOf(l)>=0)return"{$circularReference:1}";_.push(l);function s(u){return c.slice(1)+u.join(","+(c&&`
`)+t)+(c?" ":"")}if(Array.isArray(l))return`[${s(l.map(u=>i(u,o,c,t,_.slice())))}]`;let S=Object.keys(l);return S.length?`{${s(S.map(u=>(x(u)?u:JSON.stringify(u))+":"+i(l[u],o,c,t,_.slice())))}}`:"{}"}}var f=/^(abstract|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|undefined|var|void|volatile|while|with)$/;function x(m){return/^([a-z_$][0-9a-z_$]*|[0-9]+)$/gi.test(m)&&!f.test(m)}a.exports=y}),Wt=F((d,a)=>{"use strict";function y(){this._types=Object.create(null),this._extensions=Object.create(null);for(let f=0;f<arguments.length;f++)this.define(arguments[f]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}y.prototype.define=function(f,x){for(let m in f){let r=f[m].map(function(h){return h.toLowerCase()});m=m.toLowerCase();for(let h=0;h<r.length;h++){let e=r[h];if(e[0]!=="*"){if(!x&&e in this._types)throw new Error('Attempt to change mapping for "'+e+'" extension from "'+this._types[e]+'" to "'+m+'". Pass `force=true` to allow this, otherwise remove "'+e+'" from the list of extensions for "'+m+'".');this._types[e]=m}}if(x||!this._extensions[m]){let h=r[0];this._extensions[m]=h[0]!=="*"?h:h.substr(1)}}},y.prototype.getType=function(f){f=String(f);let x=f.replace(/^.*[/\\]/,"").toLowerCase(),m=x.replace(/^.*\./,"").toLowerCase(),r=x.length<f.length;return(m.length<x.length-1||!r)&&this._types[m]||null},y.prototype.getExtension=function(f){return f=/^\s*([^;\s]*)/.test(f)&&RegExp.$1,f&&this._extensions[f.toLowerCase()]||null},a.exports=y}),Dt=F((d,a)=>{a.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}}),qt=F((d,a)=>{"use strict";var y=Wt();a.exports=new y(Dt())}),Ge=F((d,a)=>{"use strict";function y(t){if(t.length===0)return;let s=Object.create(null),S=0;for(;S<t.length;++S){let g=t.charCodeAt(S);if(l[g]!==1){if(g!==47||S===0)return;break}}if(S===t.length)return;let u=t.slice(0,S).toLowerCase(),p=++S;for(;S<t.length;++S){let g=t.charCodeAt(S);if(l[g]!==1){if(S===p||f(t,S,s)===void 0)return;break}}if(S===p)return;let w=t.slice(p,S).toLowerCase();return{type:u,subtype:w,params:s}}function f(t,s,S){for(;s<t.length;){for(;s<t.length;++s){let n=t.charCodeAt(s);if(n!==32&&n!==9)break}if(s===t.length)break;if(t.charCodeAt(s++)!==59)return;for(;s<t.length;++s){let n=t.charCodeAt(s);if(n!==32&&n!==9)break}if(s===t.length)return;let u,p=s;for(;s<t.length;++s){let n=t.charCodeAt(s);if(l[n]!==1){if(n!==61)return;break}}if(s===t.length||(u=t.slice(p,s),++s,s===t.length))return;let w="",g;if(t.charCodeAt(s)===34){g=++s;let n=!1;for(;s<t.length;++s){let E=t.charCodeAt(s);if(E===92){n?(g=s,n=!1):(w+=t.slice(g,s),n=!0);continue}if(E===34){if(n){g=s,n=!1;continue}w+=t.slice(g,s);break}if(n&&(g=s-1,n=!1),o[E]!==1)return}if(s===t.length)return;++s}else{for(g=s;s<t.length;++s){let n=t.charCodeAt(s);if(l[n]!==1){if(s===g)return;break}}w=t.slice(g,s)}u=u.toLowerCase(),S[u]===void 0&&(S[u]=w)}return S}function x(t,s){if(t.length===0)return;let S=Object.create(null),u=0;for(;u<t.length;++u){let p=t.charCodeAt(u);if(l[p]!==1){if(m(t,u,S,s)===void 0)return;break}}return{type:t.slice(0,u).toLowerCase(),params:S}}function m(t,s,S,u){for(;s<t.length;){for(;s<t.length;++s){let b=t.charCodeAt(s);if(b!==32&&b!==9)break}if(s===t.length)break;if(t.charCodeAt(s++)!==59)return;for(;s<t.length;++s){let b=t.charCodeAt(s);if(b!==32&&b!==9)break}if(s===t.length)return;let p,w=s;for(;s<t.length;++s){let b=t.charCodeAt(s);if(l[b]!==1){if(b===61)break;return}}if(s===t.length)return;let g="",n,E;if(p=t.slice(w,s),p.charCodeAt(p.length-1)===42){let b=++s;for(;s<t.length;++s){let j=t.charCodeAt(s);if(c[j]!==1){if(j!==39)return;break}}if(s===t.length)return;for(E=t.slice(b,s),++s;s<t.length&&t.charCodeAt(s)!==39;++s);if(s===t.length||(++s,s===t.length))return;n=s;let L=0;for(;s<t.length;++s){let j=t.charCodeAt(s);if(C[j]!==1){if(j===37){let B,A;if(s+2<t.length&&(B=_[t.charCodeAt(s+1)])!==-1&&(A=_[t.charCodeAt(s+2)])!==-1){let P=(B<<4)+A;g+=t.slice(n,s),g+=String.fromCharCode(P),s+=2,n=s+1,P>=128?L=2:L===0&&(L=1);continue}return}break}}if(g+=t.slice(n,s),g=e(g,E,L),g===void 0)return}else{if(++s,s===t.length)return;if(t.charCodeAt(s)===34){n=++s;let b=!1;for(;s<t.length;++s){let L=t.charCodeAt(s);if(L===92){b?(n=s,b=!1):(g+=t.slice(n,s),b=!0);continue}if(L===34){if(b){n=s,b=!1;continue}g+=t.slice(n,s);break}if(b&&(n=s-1,b=!1),o[L]!==1)return}if(s===t.length)return;++s}else{for(n=s;s<t.length;++s){let b=t.charCodeAt(s);if(l[b]!==1){if(s===n)return;break}}g=t.slice(n,s)}if(g=u(g,2),g===void 0)return}p=p.toLowerCase(),S[p]===void 0&&(S[p]=g)}return S}function r(t){let s;for(;;)switch(t){case"utf-8":case"utf8":return h.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return h.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return h.utf16le;case"base64":return h.base64;default:if(s===void 0){s=!0,t=t.toLowerCase();continue}return h.other.bind(t)}}var h={utf8:(t,s)=>{if(t.length===0)return"";if(typeof t=="string"){if(s<2)return t;t=Buffer.from(t,"latin1")}return t.utf8Slice(0,t.length)},latin1:(t,s)=>t.length===0?"":typeof t=="string"?t:t.latin1Slice(0,t.length),utf16le:(t,s)=>t.length===0?"":(typeof t=="string"&&(t=Buffer.from(t,"latin1")),t.ucs2Slice(0,t.length)),base64:(t,s)=>t.length===0?"":(typeof t=="string"&&(t=Buffer.from(t,"latin1")),t.base64Slice(0,t.length)),other:(t,s)=>{if(t.length===0)return"";typeof t=="string"&&(t=Buffer.from(t,"latin1"));try{return new TextDecoder(d).decode(t)}catch{}}};function e(t,s,S){let u=r(s);if(u)return u(t,S)}function i(t){if(typeof t!="string")return"";for(let s=t.length-1;s>=0;--s)switch(t.charCodeAt(s)){case 47:case 92:return t=t.slice(s+1),t===".."||t==="."?"":t}return t===".."||t==="."?"":t}var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];a.exports={basename:i,convertToUTF8:e,getDecoder:r,parseContentType:y,parseDisposition:x}}),zt=F((d,a)=>{"use strict";function y(r,h,e,i,l){for(let o=0;o<l;++o)if(r[h+o]!==e[i+o])return!1;return!0}var f=class{constructor(r,h){if(typeof h!="function")throw new Error("Missing match callback");if(typeof r=="string")r=Buffer.from(r);else if(!Buffer.isBuffer(r))throw new Error(`Expected Buffer for needle, got ${typeof r}`);let e=r.length;if(this.maxMatches=1/0,this.matches=0,this._cb=h,this._lookbehindSize=0,this._needle=r,this._bufPos=0,this._lookbehind=Buffer.allocUnsafe(e),this._occ=[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],e>1)for(let i=0;i<e-1;++i)this._occ[r[i]]=e-1-i}reset(){this.matches=0,this._lookbehindSize=0,this._bufPos=0}push(r,h){let e;Buffer.isBuffer(r)||(r=Buffer.from(r,"latin1"));let i=r.length;for(this._bufPos=h||0;e!==i&&this.matches<this.maxMatches;)e=x(this,r);return e}destroy(){let r=this._lookbehindSize;r&&this._cb(!1,this._lookbehind,0,r,!1),this.reset()}};function x(r,h){let e=h.length,i=r._needle,l=i.length,o=-r._lookbehindSize,c=l-1,C=i[c],_=e-l,t=r._occ,s=r._lookbehind;if(o<0){for(;o<0&&o<=_;){let u=o+c,p=u<0?s[r._lookbehindSize+u]:h[u];if(p===C&&m(r,h,o,c))return r._lookbehindSize=0,++r.matches,o>-r._lookbehindSize?r._cb(!0,s,0,r._lookbehindSize+o,!1):r._cb(!0,void 0,0,0,!0),r._bufPos=o+l;o+=t[p]}for(;o<0&&!m(r,h,o,e-o);)++o;if(o<0){let u=r._lookbehindSize+o;return u>0&&r._cb(!1,s,0,u,!1),r._lookbehindSize-=u,s.copy(s,0,u,r._lookbehindSize),s.set(h,r._lookbehindSize),r._lookbehindSize+=e,r._bufPos=e,e}r._cb(!1,s,0,r._lookbehindSize,!1),r._lookbehindSize=0}o+=r._bufPos;let S=i[0];for(;o<=_;){let u=h[o+c];if(u===C&&h[o]===S&&y(i,0,h,o,c))return++r.matches,o>0?r._cb(!0,h,r._bufPos,o,!0):r._cb(!0,void 0,0,0,!0),r._bufPos=o+l;o+=t[u]}for(;o<e;){if(h[o]!==S||!y(h,o,i,0,e-o)){++o;continue}h.copy(s,0,o,e),r._lookbehindSize=e-o;break}return o>0&&r._cb(!1,h,r._bufPos,o<e?o:e,!0),r._bufPos=e,e}function m(r,h,e,i){let l=r._lookbehind,o=r._lookbehindSize,c=r._needle;for(let C=0;C<i;++C,++e)if((e<0?l[o+e]:h[e])!==c[C])return!1;return!0}a.exports=f}),Ft=F((d,a)=>{"use strict";var{Readable:y,Writable:f}=require("stream"),x=zt(),{basename:m,convertToUTF8:r,getDecoder:h,parseContentType:e,parseDisposition:i}=Ge(),l=Buffer.from(`\r
`),o=Buffer.from("\r"),c=Buffer.from("-");function C(){}var _=2e3,t=16*1024,s=0,S=1,u=2,p=class{constructor(P){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=s,this.name="",this.value="",this.crlf=0,this.cb=P}reset(){this.header=Object.create(null),this.pairCount=0,this.byteCount=0,this.state=s,this.name="",this.value="",this.crlf=0}push(P,T,R){let U=T;for(;T<R;)switch(this.state){case s:{let D=!1;for(;T<R;++T){if(this.byteCount===t)return-1;++this.byteCount;let G=P[T];if(B[G]!==1){if(G!==58||(this.name+=P.latin1Slice(U,T),this.name.length===0))return-1;++T,D=!0,this.state=S;break}}if(!D){this.name+=P.latin1Slice(U,T);break}}case S:{let D=!1;for(;T<R;++T){if(this.byteCount===t)return-1;++this.byteCount;let G=P[T];if(G!==32&&G!==9){U=T,D=!0,this.state=u;break}}if(!D)break}case u:switch(this.crlf){case 0:for(;T<R;++T){if(this.byteCount===t)return-1;++this.byteCount;let D=P[T];if(A[D]!==1){if(D!==13)return-1;++this.crlf;break}}this.value+=P.latin1Slice(U,T++);break;case 1:if(this.byteCount===t||(++this.byteCount,P[T++]!==10))return-1;++this.crlf;break;case 2:{if(this.byteCount===t)return-1;++this.byteCount;let D=P[T];D===32||D===9?(U=T,this.crlf=0):(++this.pairCount<_&&(this.name=this.name.toLowerCase(),this.header[this.name]===void 0?this.header[this.name]=[this.value]:this.header[this.name].push(this.value)),D===13?(++this.crlf,++T):(U=T,this.crlf=0,this.state=s,this.name="",this.value=""));break}case 3:{if(this.byteCount===t||(++this.byteCount,P[T++]!==10))return-1;let D=this.header;return this.reset(),this.cb(D),T}}break}return T}},w=class extends y{constructor(P,T){super(P),this.truncated=!1,this._readcb=null,this.once("end",()=>{if(this._read(),--T._fileEndsLeft===0&&T._finalcb){let R=T._finalcb;T._finalcb=null,process.nextTick(R)}})}_read(P){let T=this._readcb;T&&(this._readcb=null,T())}},g={push:(P,T)=>{},destroy:()=>{}};function n(P,T){let R=P._writecb;P._writecb=null,T?P.destroy(T):R&&R()}function E(P,T){return P}var b=class extends f{constructor(P){let T={autoDestroy:!0,emitClose:!0,highWaterMark:typeof P.highWaterMark=="number"?P.highWaterMark:void 0};if(super(T),!P.conType.params||typeof P.conType.params.boundary!="string")throw new Error("Multipart: Boundary not found");let R=P.conType.params.boundary,U=typeof P.defParamCharset=="string"&&P.defParamCharset?h(P.defParamCharset):E,D=P.defCharset||"utf8",G=P.preservePath,le={autoDestroy:!0,emitClose:!0,highWaterMark:typeof P.fileHwm=="number"?P.fileHwm:void 0},H=P.limits,Y=H&&typeof H.fieldSize=="number"?H.fieldSize:1*1024*1024,ce=H&&typeof H.fileSize=="number"?H.fileSize:1/0,Ue=H&&typeof H.files=="number"?H.files:1/0,Me=H&&typeof H.fields=="number"?H.fields:1/0,we=H&&typeof H.parts=="number"?H.parts:1/0,xe=-1,Se=0,ke=0,te=!1;this._fileEndsLeft=0,this._fileStream=void 0,this._complete=!1;let pe=0,se,oe=0,de,fe,v,k,I=!1,N=!1,O=!1;this._hparser=null;let $=new p(Q=>{this._hparser=null,te=!1,v="text/plain",de=D,fe="7bit",k=void 0,I=!1;let K;if(!Q["content-disposition"]){te=!0;return}let M=i(Q["content-disposition"][0],U);if(!M||M.type!=="form-data"){te=!0;return}if(M.params&&(M.params.name&&(k=M.params.name),M.params["filename*"]?K=M.params["filename*"]:M.params.filename&&(K=M.params.filename),K!==void 0&&!G&&(K=m(K))),Q["content-type"]){let Z=e(Q["content-type"][0]);Z&&(v=`${Z.type}/${Z.subtype}`,Z.params&&typeof Z.params.charset=="string"&&(de=Z.params.charset.toLowerCase()))}if(Q["content-transfer-encoding"]&&(fe=Q["content-transfer-encoding"][0].toLowerCase()),v==="application/octet-stream"||K!==void 0){if(ke===Ue){N||(N=!0,this.emit("filesLimit")),te=!0;return}if(++ke,this.listenerCount("file")===0){te=!0;return}pe=0,this._fileStream=new w(le,this),++this._fileEndsLeft,this.emit("file",k,this._fileStream,{filename:K,encoding:fe,mimeType:v})}else{if(Se===Me){O||(O=!0,this.emit("fieldsLimit")),te=!0;return}if(++Se,this.listenerCount("field")===0){te=!0;return}se=[],oe=0}}),J=0,ae=(Q,K,M,Z,he)=>{e:for(;K;){if(this._hparser!==null){let W=this._hparser.push(K,M,Z);if(W===-1){this._hparser=null,$.reset(),this.emit("error",new Error("Malformed part header"));break}M=W}if(M===Z)break;if(J!==0){if(J===1){switch(K[M]){case 45:J=2,++M;break;case 13:J=3,++M;break;default:J=0}if(M===Z)return}if(J===2){if(J=0,K[M]===45){this._complete=!0,this._bparser=g;return}let W=this._writecb;this._writecb=C,ae(!1,c,0,1,!1),this._writecb=W}else if(J===3)if(J=0,K[M]===10){if(++M,xe>=we||(this._hparser=$,M===Z))break;continue e}else{let W=this._writecb;this._writecb=C,ae(!1,o,0,1,!1),this._writecb=W}}if(!te){if(this._fileStream){let W,z=Math.min(Z-M,ce-pe);he?W=K.slice(M,M+z):(W=Buffer.allocUnsafe(z),K.copy(W,0,M,M+z)),pe+=W.length,pe===ce?(W.length>0&&this._fileStream.push(W),this._fileStream.emit("limit"),this._fileStream.truncated=!0,te=!0):this._fileStream.push(W)||(this._writecb&&(this._fileStream._readcb=this._writecb),this._writecb=null)}else if(se!==void 0){let W,z=Math.min(Z-M,Y-oe);he?W=K.slice(M,M+z):(W=Buffer.allocUnsafe(z),K.copy(W,0,M,M+z)),oe+=z,se.push(W),oe===Y&&(te=!0,I=!0)}}break}if(Q){if(J=1,this._fileStream)this._fileStream.push(null),this._fileStream=null;else if(se!==void 0){let W;switch(se.length){case 0:W="";break;case 1:W=r(se[0],de,0);break;default:W=r(Buffer.concat(se,oe),de,0)}se=void 0,oe=0,this.emit("field",k,W,{nameTruncated:!1,valueTruncated:I,encoding:fe,mimeType:v})}++xe===we&&this.emit("partsLimit")}};this._bparser=new x(`\r
--${R}`,ae),this._writecb=null,this._finalcb=null,this.write(l)}static detect(P){return P.type==="multipart"&&P.subtype==="form-data"}_write(P,T,R){this._writecb=R,this._bparser.push(P,0),this._writecb&&n(this)}_destroy(P,T){this._hparser=null,this._bparser=g,P||(P=j(this));let R=this._fileStream;R&&(this._fileStream=null,R.destroy(P)),T(P)}_final(P){if(this._bparser.destroy(),!this._complete)return P(new Error("Unexpected end of form"));this._fileEndsLeft?this._finalcb=L.bind(null,this,P):L(this,P)}};function L(P,T,R){if(R)return T(R);R=j(P),T(R)}function j(P){if(P._hparser)return new Error("Malformed part header");let T=P._fileStream;if(T&&(P._fileStream=null,T.destroy(new Error("Unexpected end of file"))),!P._complete)return new Error("Unexpected end of form")}var B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],A=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];a.exports=b}),$t=F((d,a)=>{"use strict";var{Writable:y}=require("stream"),{getDecoder:f}=Ge(),x=class extends y{constructor(i){let l={autoDestroy:!0,emitClose:!0,highWaterMark:typeof i.highWaterMark=="number"?i.highWaterMark:void 0};super(l);let o=i.defCharset||"utf8";i.conType.params&&typeof i.conType.params.charset=="string"&&(o=i.conType.params.charset),this.charset=o;let c=i.limits;this.fieldSizeLimit=c&&typeof c.fieldSize=="number"?c.fieldSize:1*1024*1024,this.fieldsLimit=c&&typeof c.fields=="number"?c.fields:1/0,this.fieldNameSizeLimit=c&&typeof c.fieldNameSize=="number"?c.fieldNameSize:100,this._inKey=!0,this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,this._fields=0,this._key="",this._val="",this._byte=-2,this._lastPos=0,this._encode=0,this._decoder=f(o)}static detect(i){return i.type==="application"&&i.subtype==="x-www-form-urlencoded"}_write(i,l,o){if(this._fields>=this.fieldsLimit)return o();let c=0,C=i.length;if(this._lastPos=0,this._byte!==-2){if(c=m(this,i,c,C),c===-1)return o(new Error("Malformed urlencoded form"));if(c>=C)return o();this._inKey?++this._bytesKey:++this._bytesVal}e:for(;c<C;)if(this._inKey){for(c=r(this,i,c,C);c<C;){switch(i[c]){case 61:this._lastPos<c&&(this._key+=i.latin1Slice(this._lastPos,c)),this._lastPos=++c,this._key=this._decoder(this._key,this._encode),this._encode=0,this._inKey=!1;continue e;case 38:if(this._lastPos<c&&(this._key+=i.latin1Slice(this._lastPos,c)),this._lastPos=++c,this._key=this._decoder(this._key,this._encode),this._encode=0,this._bytesKey>0&&this.emit("field",this._key,"",{nameTruncated:this._keyTrunc,valueTruncated:!1,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),o();continue;case 43:this._lastPos<c&&(this._key+=i.latin1Slice(this._lastPos,c)),this._key+=" ",this._lastPos=c+1;break;case 37:if(this._encode===0&&(this._encode=1),this._lastPos<c&&(this._key+=i.latin1Slice(this._lastPos,c)),this._lastPos=c+1,this._byte=-1,c=m(this,i,c+1,C),c===-1)return o(new Error("Malformed urlencoded form"));if(c>=C)return o();++this._bytesKey,c=r(this,i,c,C);continue}++c,++this._bytesKey,c=r(this,i,c,C)}this._lastPos<c&&(this._key+=i.latin1Slice(this._lastPos,c))}else{for(c=h(this,i,c,C);c<C;){switch(i[c]){case 38:if(this._lastPos<c&&(this._val+=i.latin1Slice(this._lastPos,c)),this._lastPos=++c,this._inKey=!0,this._val=this._decoder(this._val,this._encode),this._encode=0,(this._bytesKey>0||this._bytesVal>0)&&this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"}),this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._bytesKey=0,this._bytesVal=0,++this._fields>=this.fieldsLimit)return this.emit("fieldsLimit"),o();continue e;case 43:this._lastPos<c&&(this._val+=i.latin1Slice(this._lastPos,c)),this._val+=" ",this._lastPos=c+1;break;case 37:if(this._encode===0&&(this._encode=1),this._lastPos<c&&(this._val+=i.latin1Slice(this._lastPos,c)),this._lastPos=c+1,this._byte=-1,c=m(this,i,c+1,C),c===-1)return o(new Error("Malformed urlencoded form"));if(c>=C)return o();++this._bytesVal,c=h(this,i,c,C);continue}++c,++this._bytesVal,c=h(this,i,c,C)}this._lastPos<c&&(this._val+=i.latin1Slice(this._lastPos,c))}o()}_final(i){if(this._byte!==-2)return i(new Error("Malformed urlencoded form"));(!this._inKey||this._bytesKey>0||this._bytesVal>0)&&(this._inKey?this._key=this._decoder(this._key,this._encode):this._val=this._decoder(this._val,this._encode),this.emit("field",this._key,this._val,{nameTruncated:this._keyTrunc,valueTruncated:this._valTrunc,encoding:this.charset,mimeType:"text/plain"})),i()}};function m(i,l,o,c){if(o>=c)return c;if(i._byte===-1){let C=e[l[o++]];if(C===-1)return-1;if(C>=8&&(i._encode=2),o<c){let _=e[l[o++]];if(_===-1)return-1;i._inKey?i._key+=String.fromCharCode((C<<4)+_):i._val+=String.fromCharCode((C<<4)+_),i._byte=-2,i._lastPos=o}else i._byte=C}else{let C=e[l[o++]];if(C===-1)return-1;i._inKey?i._key+=String.fromCharCode((i._byte<<4)+C):i._val+=String.fromCharCode((i._byte<<4)+C),i._byte=-2,i._lastPos=o}return o}function r(i,l,o,c){if(i._bytesKey>i.fieldNameSizeLimit){for(i._keyTrunc||i._lastPos<o&&(i._key+=l.latin1Slice(i._lastPos,o-1)),i._keyTrunc=!0;o<c;++o){let C=l[o];if(C===61||C===38)break;++i._bytesKey}i._lastPos=o}return o}function h(i,l,o,c){if(i._bytesVal>i.fieldSizeLimit){for(i._valTrunc||i._lastPos<o&&(i._val+=l.latin1Slice(i._lastPos,o-1)),i._valTrunc=!0;o<c&&l[o]!==38;++o)++i._bytesVal;i._lastPos=o}return o}var e=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];a.exports=x}),Vt=F((d,a)=>{"use strict";var{parseContentType:y}=Ge();function f(m){let r=m.headers,h=y(r["content-type"]);if(!h)throw new Error("Malformed content type");for(let e of x){if(!e.detect(h))continue;let i={limits:m.limits,headers:r,conType:h,highWaterMark:void 0,fileHwm:void 0,defCharset:void 0,defParamCharset:void 0,preservePath:!1};return m.highWaterMark&&(i.highWaterMark=m.highWaterMark),m.fileHwm&&(i.fileHwm=m.fileHwm),i.defCharset=m.defCharset,i.defParamCharset=m.defParamCharset,i.preservePath=m.preservePath,new e(i)}throw new Error(`Unsupported content type: ${r["content-type"]}`)}var x=[Ft(),$t()].filter(function(m){return typeof m.detect=="function"});a.exports=m=>{if((typeof m!="object"||m===null)&&(m={}),typeof m.headers!="object"||m.headers===null||typeof m.headers["content-type"]!="string")throw new Error("Missing Content-Type");return f(m)}}),Gt=F((d,a)=>{"use strict";var{Duplex:y}=require("stream");function f(h){h.emit("close")}function x(){!this.destroyed&&this._writableState.finished&&this.destroy()}function m(h){this.removeListener("error",m),this.destroy(),this.listenerCount("error")===0&&this.emit("error",h)}function r(h,e){let i=!0,l=new y({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return h.on("message",function(o,c){let C=!c&&l._readableState.objectMode?o.toString():o;l.push(C)||h.pause()}),h.once("error",function(o){l.destroyed||(i=!1,l.destroy(o))}),h.once("close",function(){l.destroyed||l.push(null)}),l._destroy=function(o,c){if(h.readyState===h.CLOSED){c(o),process.nextTick(f,l);return}let C=!1;h.once("error",function(_){C=!0,c(_)}),h.once("close",function(){C||c(o),process.nextTick(f,l)}),i&&h.terminate()},l._final=function(o){if(h.readyState===h.CONNECTING){h.once("open",function(){l._final(o)});return}h._socket!==null&&(h._socket._writableState.finished?(o(),l._readableState.endEmitted&&l.destroy()):(h._socket.once("finish",function(){o()}),h.close()))},l._read=function(){h.isPaused&&h.resume()},l._write=function(o,c,C){if(h.readyState===h.CONNECTING){h.once("open",function(){l._write(o,c,C)});return}h.send(o,C)},l.on("end",x),l.on("error",m),l}a.exports=r}),ye=F((d,a)=>{"use strict";a.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}}),Le=F((d,a)=>{"use strict";var{EMPTY_BUFFER:y}=ye(),f=Buffer[Symbol.species];function x(i,l){if(i.length===0)return y;if(i.length===1)return i[0];let o=Buffer.allocUnsafe(l),c=0;for(let C=0;C<i.length;C++){let _=i[C];o.set(_,c),c+=_.length}return c<l?new f(o.buffer,o.byteOffset,c):o}function m(i,l,o,c,C){for(let _=0;_<C;_++)o[c+_]=i[_]^l[_&3]}function r(i,l){for(let o=0;o<i.length;o++)i[o]^=l[o&3]}function h(i){return i.length===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.length)}function e(i){if(e.readOnly=!0,Buffer.isBuffer(i))return i;let l;return i instanceof ArrayBuffer?l=new f(i):ArrayBuffer.isView(i)?l=new f(i.buffer,i.byteOffset,i.byteLength):(l=Buffer.from(i),e.readOnly=!1),l}if(a.exports={concat:x,mask:m,toArrayBuffer:h,toBuffer:e,unmask:r},!process.env.WS_NO_BUFFER_UTIL)try{let i=require("bufferutil");a.exports.mask=function(l,o,c,C,_){_<48?m(l,o,c,C,_):i.mask(l,o,c,C,_)},a.exports.unmask=function(l,o){l.length<32?r(l,o):i.unmask(l,o)}}catch{}}),Kt=F((d,a)=>{"use strict";var y=Symbol("kDone"),f=Symbol("kRun"),x=class{constructor(m){this[y]=()=>{this.pending--,this[f]()},this.concurrency=m||1/0,this.jobs=[],this.pending=0}add(m){this.jobs.push(m),this[f]()}[f](){if(this.pending!==this.concurrency&&this.jobs.length){let m=this.jobs.shift();this.pending++,m(this[y])}}};a.exports=x}),Ne=F((d,a)=>{"use strict";var y=require("zlib"),f=Le(),x=Kt(),{kStatusCode:m}=ye(),r=Buffer[Symbol.species],h=Buffer.from([0,0,255,255]),e=Symbol("permessage-deflate"),i=Symbol("total-length"),l=Symbol("callback"),o=Symbol("buffers"),c=Symbol("error"),C,_=class{constructor(u,p,w){if(this._maxPayload=w|0,this._options=u||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!p,this._deflate=null,this._inflate=null,this.params=null,!C){let g=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;C=new x(g)}}static get extensionName(){return"permessage-deflate"}offer(){let u={};return this._options.serverNoContextTakeover&&(u.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(u.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(u.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?u.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(u.client_max_window_bits=!0),u}accept(u){return u=this.normalizeParams(u),this.params=this._isServer?this.acceptAsServer(u):this.acceptAsClient(u),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let u=this._deflate[l];this._deflate.close(),this._deflate=null,u&&u(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(u){let p=this._options,w=u.find(g=>!(p.serverNoContextTakeover===!1&&g.server_no_context_takeover||g.server_max_window_bits&&(p.serverMaxWindowBits===!1||typeof p.serverMaxWindowBits=="number"&&p.serverMaxWindowBits>g.server_max_window_bits)||typeof p.clientMaxWindowBits=="number"&&!g.client_max_window_bits));if(!w)throw new Error("None of the extension offers can be accepted");return p.serverNoContextTakeover&&(w.server_no_context_takeover=!0),p.clientNoContextTakeover&&(w.client_no_context_takeover=!0),typeof p.serverMaxWindowBits=="number"&&(w.server_max_window_bits=p.serverMaxWindowBits),typeof p.clientMaxWindowBits=="number"?w.client_max_window_bits=p.clientMaxWindowBits:(w.client_max_window_bits===!0||p.clientMaxWindowBits===!1)&&delete w.client_max_window_bits,w}acceptAsClient(u){let p=u[0];if(this._options.clientNoContextTakeover===!1&&p.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!p.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(p.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&p.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return p}normalizeParams(u){return u.forEach(p=>{Object.keys(p).forEach(w=>{let g=p[w];if(g.length>1)throw new Error(`Parameter "${w}" must have only a single value`);if(g=g[0],w==="client_max_window_bits"){if(g!==!0){let n=+g;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${w}": ${g}`);g=n}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${w}": ${g}`)}else if(w==="server_max_window_bits"){let n=+g;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${w}": ${g}`);g=n}else if(w==="client_no_context_takeover"||w==="server_no_context_takeover"){if(g!==!0)throw new TypeError(`Invalid value for parameter "${w}": ${g}`)}else throw new Error(`Unknown parameter "${w}"`);p[w]=g})}),u}decompress(u,p,w){C.add(g=>{this._decompress(u,p,(n,E)=>{g(),w(n,E)})})}compress(u,p,w){C.add(g=>{this._compress(u,p,(n,E)=>{g(),w(n,E)})})}_decompress(u,p,w){let g=this._isServer?"client":"server";if(!this._inflate){let n=`${g}_max_window_bits`,E=typeof this.params[n]!="number"?y.Z_DEFAULT_WINDOWBITS:this.params[n];this._inflate=y.createInflateRaw({...this._options.zlibInflateOptions,windowBits:E}),this._inflate[e]=this,this._inflate[i]=0,this._inflate[o]=[],this._inflate.on("error",S),this._inflate.on("data",s)}this._inflate[l]=w,this._inflate.write(u),p&&this._inflate.write(h),this._inflate.flush(()=>{let n=this._inflate[c];if(n){this._inflate.close(),this._inflate=null,w(n);return}let E=f.concat(this._inflate[o],this._inflate[i]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[i]=0,this._inflate[o]=[],p&&this.params[`${g}_no_context_takeover`]&&this._inflate.reset()),w(null,E)})}_compress(u,p,w){let g=this._isServer?"server":"client";if(!this._deflate){let n=`${g}_max_window_bits`,E=typeof this.params[n]!="number"?y.Z_DEFAULT_WINDOWBITS:this.params[n];this._deflate=y.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:E}),this._deflate[i]=0,this._deflate[o]=[],this._deflate.on("data",t)}this._deflate[l]=w,this._deflate.write(u),this._deflate.flush(y.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let n=f.concat(this._deflate[o],this._deflate[i]);p&&(n=new r(n.buffer,n.byteOffset,n.length-4)),this._deflate[l]=null,this._deflate[i]=0,this._deflate[o]=[],p&&this.params[`${g}_no_context_takeover`]&&this._deflate.reset(),w(null,n)})}};a.exports=_;function t(u){this[o].push(u),this[i]+=u.length}function s(u){if(this[i]+=u.length,this[e]._maxPayload<1||this[i]<=this[e]._maxPayload){this[o].push(u);return}this[c]=new RangeError("Max payload size exceeded"),this[c].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[c][m]=1009,this.removeListener("data",s),this.reset()}function S(u){this[e]._inflate=null,u[m]=1007,this[l](u)}}),je=F((d,a)=>{"use strict";var{isUtf8:y}=require("buffer"),f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function x(r){return r>=1e3&&r<=1014&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999}function m(r){let h=r.length,e=0;for(;e<h;)if(!(r[e]&128))e++;else if((r[e]&224)===192){if(e+1===h||(r[e+1]&192)!==128||(r[e]&254)===192)return!1;e+=2}else if((r[e]&240)===224){if(e+2>=h||(r[e+1]&192)!==128||(r[e+2]&192)!==128||r[e]===224&&(r[e+1]&224)===128||r[e]===237&&(r[e+1]&224)===160)return!1;e+=3}else if((r[e]&248)===240){if(e+3>=h||(r[e+1]&192)!==128||(r[e+2]&192)!==128||(r[e+3]&192)!==128||r[e]===240&&(r[e+1]&240)===128||r[e]===244&&r[e+1]>143||r[e]>244)return!1;e+=4}else return!1;return!0}if(a.exports={isValidStatusCode:x,isValidUTF8:m,tokenChars:f},y)a.exports.isValidUTF8=function(r){return r.length<24?m(r):y(r)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let r=require("utf-8-validate");a.exports.isValidUTF8=function(h){return h.length<32?m(h):r(h)}}catch{}}),at=F((d,a)=>{"use strict";var{Writable:y}=require("stream"),f=Ne(),{BINARY_TYPES:x,EMPTY_BUFFER:m,kStatusCode:r,kWebSocket:h}=ye(),{concat:e,toArrayBuffer:i,unmask:l}=Le(),{isValidStatusCode:o,isValidUTF8:c}=je(),C=Buffer[Symbol.species],_=0,t=1,s=2,S=3,u=4,p=5,w=class extends y{constructor(n={}){super(),this._binaryType=n.binaryType||x[0],this._extensions=n.extensions||{},this._isServer=!!n.isServer,this._maxPayload=n.maxPayload|0,this._skipUTF8Validation=!!n.skipUTF8Validation,this[h]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=_,this._loop=!1}_write(n,E,b){if(this._opcode===8&&this._state==_)return b();this._bufferedBytes+=n.length,this._buffers.push(n),this.startLoop(b)}consume(n){if(this._bufferedBytes-=n,n===this._buffers[0].length)return this._buffers.shift();if(n<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=new C(b.buffer,b.byteOffset+n,b.length-n),new C(b.buffer,b.byteOffset,n)}let E=Buffer.allocUnsafe(n);do{let b=this._buffers[0],L=E.length-n;n>=b.length?E.set(this._buffers.shift(),L):(E.set(new Uint8Array(b.buffer,b.byteOffset,n),L),this._buffers[0]=new C(b.buffer,b.byteOffset+n,b.length-n)),n-=b.length}while(n>0);return E}startLoop(n){let E;this._loop=!0;do switch(this._state){case _:E=this.getInfo();break;case t:E=this.getPayloadLength16();break;case s:E=this.getPayloadLength64();break;case S:this.getMask();break;case u:E=this.getData(n);break;default:this._loop=!1;return}while(this._loop);n(E)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let n=this.consume(2);if(n[0]&48)return this._loop=!1,g(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let E=(n[0]&64)===64;if(E&&!this._extensions[f.extensionName])return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(n[0]&128)===128,this._opcode=n[0]&15,this._payloadLength=n[1]&127,this._opcode===0){if(E)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,g(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=E}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,g(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(E)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,g(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(n[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,g(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,g(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=t;else if(this._payloadLength===127)this._state=s;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let n=this.consume(8),E=n.readUInt32BE(0);return E>Math.pow(2,53-32)-1?(this._loop=!1,g(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=E*Math.pow(2,32)+n.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,g(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=S:this._state=u}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=u}getData(n){let E=m;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}E=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&l(E,this._mask)}if(this._opcode>7)return this.controlMessage(E);if(this._compressed){this._state=p,this.decompress(E,n);return}return E.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(E)),this.dataMessage()}decompress(n,E){this._extensions[f.extensionName].decompress(n,this._fin,(b,L)=>{if(b)return E(b);if(L.length){if(this._messageLength+=L.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return E(g(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(L)}let j=this.dataMessage();if(j)return E(j);this.startLoop(E)})}dataMessage(){if(this._fin){let n=this._messageLength,E=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let b;this._binaryType==="nodebuffer"?b=e(E,n):this._binaryType==="arraybuffer"?b=i(e(E,n)):b=E,this.emit("message",b,!0)}else{let b=e(E,n);if(!this._skipUTF8Validation&&!c(b))return this._loop=!1,g(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",b,!1)}}this._state=_}controlMessage(n){if(this._opcode===8)if(this._loop=!1,n.length===0)this.emit("conclude",1005,m),this.end();else{let E=n.readUInt16BE(0);if(!o(E))return g(RangeError,`invalid status code ${E}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let b=new C(n.buffer,n.byteOffset+2,n.length-2);if(!this._skipUTF8Validation&&!c(b))return g(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",E,b),this.end()}else this._opcode===9?this.emit("ping",n):this.emit("pong",n);this._state=_}};a.exports=w;function g(n,E,b,L,j){let B=new n(b?`Invalid WebSocket frame: ${E}`:E);return Error.captureStackTrace(B,g),B.code=j,B[r]=L,B}}),nt=F((d,a)=>{"use strict";var y=require("net"),f=require("tls"),{randomFillSync:x}=require("crypto"),m=Ne(),{EMPTY_BUFFER:r}=ye(),{isValidStatusCode:h}=je(),{mask:e,toBuffer:i}=Le(),l=Symbol("kByteLength"),o=Buffer.alloc(4),c=class me{constructor(_,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=_,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(_,t){let s,S=!1,u=2,p=!1;t.mask&&(s=t.maskBuffer||o,t.generateMask?t.generateMask(s):x(s,0,4),p=(s[0]|s[1]|s[2]|s[3])===0,u=6);let w;typeof _=="string"?(!t.mask||p)&&t[l]!==void 0?w=t[l]:(_=Buffer.from(_),w=_.length):(w=_.length,S=t.mask&&t.readOnly&&!p);let g=w;w>=65536?(u+=8,g=127):w>125&&(u+=2,g=126);let n=Buffer.allocUnsafe(S?w+u:u);return n[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(n[0]|=64),n[1]=g,g===126?n.writeUInt16BE(w,2):g===127&&(n[2]=n[3]=0,n.writeUIntBE(w,4,6)),t.mask?(n[1]|=128,n[u-4]=s[0],n[u-3]=s[1],n[u-2]=s[2],n[u-1]=s[3],p?[n,_]:S?(e(_,s,n,u,w),[n]):(e(_,s,_,0,w),[n,_])):[n,_]}close(_,t,s,S){let u;if(_===void 0)u=r;else{if(typeof _!="number"||!h(_))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)u=Buffer.allocUnsafe(2),u.writeUInt16BE(_,0);else{let w=Buffer.byteLength(t);if(w>123)throw new RangeError("The message must not be greater than 123 bytes");u=Buffer.allocUnsafe(2+w),u.writeUInt16BE(_,0),typeof t=="string"?u.write(t,2):u.set(t,2)}}let p={[l]:u.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,u,!1,p,S]):this.sendFrame(me.frame(u,p),S)}ping(_,t,s){let S,u;if(typeof _=="string"?(S=Buffer.byteLength(_),u=!1):(_=i(_),S=_.length,u=i.readOnly),S>125)throw new RangeError("The data size must not be greater than 125 bytes");let p={[l]:S,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:u,rsv1:!1};this._deflating?this.enqueue([this.dispatch,_,!1,p,s]):this.sendFrame(me.frame(_,p),s)}pong(_,t,s){let S,u;if(typeof _=="string"?(S=Buffer.byteLength(_),u=!1):(_=i(_),S=_.length,u=i.readOnly),S>125)throw new RangeError("The data size must not be greater than 125 bytes");let p={[l]:S,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:u,rsv1:!1};this._deflating?this.enqueue([this.dispatch,_,!1,p,s]):this.sendFrame(me.frame(_,p),s)}send(_,t,s){let S=this._extensions[m.extensionName],u=t.binary?2:1,p=t.compress,w,g;if(typeof _=="string"?(w=Buffer.byteLength(_),g=!1):(_=i(_),w=_.length,g=i.readOnly),this._firstFragment?(this._firstFragment=!1,p&&S&&S.params[S._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(p=w>=S._threshold),this._compress=p):(p=!1,u=0),t.fin&&(this._firstFragment=!0),S){let n={[l]:w,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:u,readOnly:g,rsv1:p};this._deflating?this.enqueue([this.dispatch,_,this._compress,n,s]):this.dispatch(_,this._compress,n,s)}else this.sendFrame(me.frame(_,{[l]:w,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:u,readOnly:g,rsv1:!1}),s)}dispatch(_,t,s,S){if(!t){this.sendFrame(me.frame(_,s),S);return}let u=this._extensions[m.extensionName];this._bufferedBytes+=s[l],this._deflating=!0,u.compress(_,s.fin,(p,w)=>{if(this._socket.destroyed){let g=new Error("The socket was closed while data was being compressed");typeof S=="function"&&S(g);for(let n=0;n<this._queue.length;n++){let E=this._queue[n],b=E[E.length-1];typeof b=="function"&&b(g)}return}this._bufferedBytes-=s[l],this._deflating=!1,s.readOnly=!1,this.sendFrame(me.frame(w,s),S),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let _=this._queue.shift();this._bufferedBytes-=_[3][l],Reflect.apply(_[0],this,_.slice(1))}}enqueue(_){this._bufferedBytes+=_[3][l],this._queue.push(_)}sendFrame(_,t){_.length===2?(this._socket.cork(),this._socket.write(_[0]),this._socket.write(_[1],t),this._socket.uncork()):this._socket.write(_[0],t)}};a.exports=c}),Ht=F((d,a)=>{"use strict";var{kForOnEventAttribute:y,kListener:f}=ye(),x=Symbol("kCode"),m=Symbol("kData"),r=Symbol("kError"),h=Symbol("kMessage"),e=Symbol("kReason"),i=Symbol("kTarget"),l=Symbol("kType"),o=Symbol("kWasClean"),c=class{constructor(u){this[i]=null,this[l]=u}get target(){return this[i]}get type(){return this[l]}};Object.defineProperty(c.prototype,"target",{enumerable:!0}),Object.defineProperty(c.prototype,"type",{enumerable:!0});var C=class extends c{constructor(u,p={}){super(u),this[x]=p.code===void 0?0:p.code,this[e]=p.reason===void 0?"":p.reason,this[o]=p.wasClean===void 0?!1:p.wasClean}get code(){return this[x]}get reason(){return this[e]}get wasClean(){return this[o]}};Object.defineProperty(C.prototype,"code",{enumerable:!0}),Object.defineProperty(C.prototype,"reason",{enumerable:!0}),Object.defineProperty(C.prototype,"wasClean",{enumerable:!0});var _=class extends c{constructor(u,p={}){super(u),this[r]=p.error===void 0?null:p.error,this[h]=p.message===void 0?"":p.message}get error(){return this[r]}get message(){return this[h]}};Object.defineProperty(_.prototype,"error",{enumerable:!0}),Object.defineProperty(_.prototype,"message",{enumerable:!0});var t=class extends c{constructor(u,p={}){super(u),this[m]=p.data===void 0?null:p.data}get data(){return this[m]}};Object.defineProperty(t.prototype,"data",{enumerable:!0});var s={addEventListener(u,p,w={}){for(let n of this.listeners(u))if(!w[y]&&n[f]===p&&!n[y])return;let g;if(u==="message")g=function(n,E){let b=new t("message",{data:E?n:n.toString()});b[i]=this,S(p,this,b)};else if(u==="close")g=function(n,E){let b=new C("close",{code:n,reason:E.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});b[i]=this,S(p,this,b)};else if(u==="error")g=function(n){let E=new _("error",{error:n,message:n.message});E[i]=this,S(p,this,E)};else if(u==="open")g=function(){let n=new c("open");n[i]=this,S(p,this,n)};else return;g[y]=!!w[y],g[f]=p,w.once?this.once(u,g):this.on(u,g)},removeEventListener(u,p){for(let w of this.listeners(u))if(w[f]===p&&!w[y]){this.removeListener(u,w);break}}};a.exports={CloseEvent:C,ErrorEvent:_,Event:c,EventTarget:s,MessageEvent:t};function S(u,p,w){typeof u=="object"&&u.handleEvent?u.handleEvent.call(u,w):u.call(p,w)}}),lt=F((d,a)=>{"use strict";var{tokenChars:y}=je();function f(r,h,e){r[h]===void 0?r[h]=[e]:r[h].push(e)}function x(r){let h=Object.create(null),e=Object.create(null),i=!1,l=!1,o=!1,c,C,_=-1,t=-1,s=-1,S=0;for(;S<r.length;S++)if(t=r.charCodeAt(S),c===void 0)if(s===-1&&y[t]===1)_===-1&&(_=S);else if(S!==0&&(t===32||t===9))s===-1&&_!==-1&&(s=S);else if(t===59||t===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${S}`);s===-1&&(s=S);let p=r.slice(_,s);t===44?(f(h,p,e),e=Object.create(null)):c=p,_=s=-1}else throw new SyntaxError(`Unexpected character at index ${S}`);else if(C===void 0)if(s===-1&&y[t]===1)_===-1&&(_=S);else if(t===32||t===9)s===-1&&_!==-1&&(s=S);else if(t===59||t===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${S}`);s===-1&&(s=S),f(e,r.slice(_,s),!0),t===44&&(f(h,c,e),e=Object.create(null),c=void 0),_=s=-1}else if(t===61&&_!==-1&&s===-1)C=r.slice(_,S),_=s=-1;else throw new SyntaxError(`Unexpected character at index ${S}`);else if(l){if(y[t]!==1)throw new SyntaxError(`Unexpected character at index ${S}`);_===-1?_=S:i||(i=!0),l=!1}else if(o)if(y[t]===1)_===-1&&(_=S);else if(t===34&&_!==-1)o=!1,s=S;else if(t===92)l=!0;else throw new SyntaxError(`Unexpected character at index ${S}`);else if(t===34&&r.charCodeAt(S-1)===61)o=!0;else if(s===-1&&y[t]===1)_===-1&&(_=S);else if(_!==-1&&(t===32||t===9))s===-1&&(s=S);else if(t===59||t===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${S}`);s===-1&&(s=S);let p=r.slice(_,s);i&&(p=p.replace(/\\/g,""),i=!1),f(e,C,p),t===44&&(f(h,c,e),e=Object.create(null),c=void 0),C=void 0,_=s=-1}else throw new SyntaxError(`Unexpected character at index ${S}`);if(_===-1||o||t===32||t===9)throw new SyntaxError("Unexpected end of input");s===-1&&(s=S);let u=r.slice(_,s);return c===void 0?f(h,u,e):(C===void 0?f(e,u,!0):i?f(e,C,u.replace(/\\/g,"")):f(e,C,u),f(h,c,e)),h}function m(r){return Object.keys(r).map(h=>{let e=r[h];return Array.isArray(e)||(e=[e]),e.map(i=>[h].concat(Object.keys(i).map(l=>{let o=i[l];return Array.isArray(o)||(o=[o]),o.map(c=>c===!0?l:`${l}=${c}`).join("; ")})).join("; ")).join(", ")}).join(", ")}a.exports={format:m,parse:x}}),ct=F((d,a)=>{"use strict";var y=require("events"),f=require("https"),x=require("http"),m=require("net"),r=require("tls"),{randomBytes:h,createHash:e}=require("crypto"),{Readable:i}=require("stream"),{URL:l}=require("url"),o=Ne(),c=at(),C=nt(),{BINARY_TYPES:_,EMPTY_BUFFER:t,GUID:s,kForOnEventAttribute:S,kListener:u,kStatusCode:p,kWebSocket:w,NOOP:g}=ye(),{EventTarget:{addEventListener:n,removeEventListener:E}}=Ht(),{format:b,parse:L}=lt(),{toBuffer:j}=Le(),B=30*1e3,A=Symbol("kAborted"),P=[8,13],T=["CONNECTING","OPEN","CLOSING","CLOSED"],R=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,U=class V extends y{constructor(k,I,N){super(),this._binaryType=_[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=t,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=V.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,k!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,I===void 0?I=[]:Array.isArray(I)||(typeof I=="object"&&I!==null?(N=I,I=[]):I=[I]),D(this,k,I,N)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(k){_.includes(k)&&(this._binaryType=k,this._receiver&&(this._receiver._binaryType=k))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(k,I,N){let O=new c({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:N.maxPayload,skipUTF8Validation:N.skipUTF8Validation});this._sender=new C(k,this._extensions,N.generateMask),this._receiver=O,this._socket=k,O[w]=this,k[w]=this,O.on("conclude",Ue),O.on("drain",Me),O.on("error",we),O.on("message",Se),O.on("ping",ke),O.on("pong",te),k.setTimeout(0),k.setNoDelay(),I.length>0&&k.unshift(I),k.on("close",se),k.on("data",oe),k.on("end",de),k.on("error",fe),this._readyState=V.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=V.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[o.extensionName]&&this._extensions[o.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=V.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(k,I){if(this.readyState!==V.CLOSED){if(this.readyState===V.CONNECTING){let N="WebSocket was closed before the connection was established";Y(this,this._req,N);return}if(this.readyState===V.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=V.CLOSING,this._sender.close(k,I,!this._isServer,N=>{N||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),B)}}pause(){this.readyState===V.CONNECTING||this.readyState===V.CLOSED||(this._paused=!0,this._socket.pause())}ping(k,I,N){if(this.readyState===V.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof k=="function"?(N=k,k=I=void 0):typeof I=="function"&&(N=I,I=void 0),typeof k=="number"&&(k=k.toString()),this.readyState!==V.OPEN){ce(this,k,N);return}I===void 0&&(I=!this._isServer),this._sender.ping(k||t,I,N)}pong(k,I,N){if(this.readyState===V.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof k=="function"?(N=k,k=I=void 0):typeof I=="function"&&(N=I,I=void 0),typeof k=="number"&&(k=k.toString()),this.readyState!==V.OPEN){ce(this,k,N);return}I===void 0&&(I=!this._isServer),this._sender.pong(k||t,I,N)}resume(){this.readyState===V.CONNECTING||this.readyState===V.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(k,I,N){if(this.readyState===V.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof I=="function"&&(N=I,I={}),typeof k=="number"&&(k=k.toString()),this.readyState!==V.OPEN){ce(this,k,N);return}let O={binary:typeof k!="string",mask:!this._isServer,compress:!0,fin:!0,...I};this._extensions[o.extensionName]||(O.compress=!1),this._sender.send(k||t,O,N)}terminate(){if(this.readyState!==V.CLOSED){if(this.readyState===V.CONNECTING){let k="WebSocket was closed before the connection was established";Y(this,this._req,k);return}this._socket&&(this._readyState=V.CLOSING,this._socket.destroy())}}};Object.defineProperty(U,"CONNECTING",{enumerable:!0,value:T.indexOf("CONNECTING")}),Object.defineProperty(U.prototype,"CONNECTING",{enumerable:!0,value:T.indexOf("CONNECTING")}),Object.defineProperty(U,"OPEN",{enumerable:!0,value:T.indexOf("OPEN")}),Object.defineProperty(U.prototype,"OPEN",{enumerable:!0,value:T.indexOf("OPEN")}),Object.defineProperty(U,"CLOSING",{enumerable:!0,value:T.indexOf("CLOSING")}),Object.defineProperty(U.prototype,"CLOSING",{enumerable:!0,value:T.indexOf("CLOSING")}),Object.defineProperty(U,"CLOSED",{enumerable:!0,value:T.indexOf("CLOSED")}),Object.defineProperty(U.prototype,"CLOSED",{enumerable:!0,value:T.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(v=>{Object.defineProperty(U.prototype,v,{enumerable:!0})}),["open","error","close","message"].forEach(v=>{Object.defineProperty(U.prototype,`on${v}`,{enumerable:!0,get(){for(let k of this.listeners(v))if(k[S])return k[u];return null},set(k){for(let I of this.listeners(v))if(I[S]){this.removeListener(v,I);break}typeof k=="function"&&this.addEventListener(v,k,{[S]:!0})}})}),U.prototype.addEventListener=n,U.prototype.removeEventListener=E,a.exports=U;function D(v,k,I,N){let O={protocolVersion:P[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...N,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!P.includes(O.protocolVersion))throw new RangeError(`Unsupported protocol version: ${O.protocolVersion} (supported versions: ${P.join(", ")})`);let $;if(k instanceof l)$=k,v._url=k.href;else{try{$=new l(k)}catch{throw new SyntaxError(`Invalid URL: ${k}`)}v._url=k}let J=$.protocol==="wss:",ae=$.protocol==="ws+unix:",Q;if($.protocol!=="ws:"&&!J&&!ae?Q=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:ae&&!$.pathname?Q="The URL's pathname is empty":$.hash&&(Q="The URL contains a fragment identifier"),Q){let q=new SyntaxError(Q);if(v._redirects===0)throw q;G(v,q);return}let K=J?443:80,M=h(16).toString("base64"),Z=J?f.request:x.request,he=new Set,W;if(O.createConnection=J?H:le,O.defaultPort=O.defaultPort||K,O.port=$.port||K,O.host=$.hostname.startsWith("[")?$.hostname.slice(1,-1):$.hostname,O.headers={...O.headers,"Sec-WebSocket-Version":O.protocolVersion,"Sec-WebSocket-Key":M,Connection:"Upgrade",Upgrade:"websocket"},O.path=$.pathname+$.search,O.timeout=O.handshakeTimeout,O.perMessageDeflate&&(W=new o(O.perMessageDeflate!==!0?O.perMessageDeflate:{},!1,O.maxPayload),O.headers["Sec-WebSocket-Extensions"]=b({[o.extensionName]:W.offer()})),I.length){for(let q of I){if(typeof q!="string"||!R.test(q)||he.has(q))throw new SyntaxError("An invalid or duplicated subprotocol was specified");he.add(q)}O.headers["Sec-WebSocket-Protocol"]=I.join(",")}if(O.origin&&(O.protocolVersion<13?O.headers["Sec-WebSocket-Origin"]=O.origin:O.headers.Origin=O.origin),($.username||$.password)&&(O.auth=`${$.username}:${$.password}`),ae){let q=O.path.split(":");O.socketPath=q[0],O.path=q[1]}let z;if(O.followRedirects){if(v._redirects===0){v._originalIpc=ae,v._originalSecure=J,v._originalHostOrSocketPath=ae?O.socketPath:$.host;let q=N&&N.headers;if(N={...N,headers:{}},q)for(let[ee,ge]of Object.entries(q))N.headers[ee.toLowerCase()]=ge}else if(v.listenerCount("redirect")===0){let q=ae?v._originalIpc?O.socketPath===v._originalHostOrSocketPath:!1:v._originalIpc?!1:$.host===v._originalHostOrSocketPath;(!q||v._originalSecure&&!J)&&(delete O.headers.authorization,delete O.headers.cookie,q||delete O.headers.host,O.auth=void 0)}O.auth&&!N.headers.authorization&&(N.headers.authorization="Basic "+Buffer.from(O.auth).toString("base64")),z=v._req=Z(O),v._redirects&&v.emit("redirect",v.url,z)}else z=v._req=Z(O);O.timeout&&z.on("timeout",()=>{Y(v,z,"Opening handshake has timed out")}),z.on("error",q=>{z===null||z[A]||(z=v._req=null,G(v,q))}),z.on("response",q=>{let ee=q.headers.location,ge=q.statusCode;if(ee&&O.followRedirects&&ge>=300&&ge<400){if(++v._redirects>O.maxRedirects){Y(v,z,"Maximum redirects exceeded");return}z.abort();let Ce;try{Ce=new l(ee,k)}catch{let be=new SyntaxError(`Invalid URL: ${ee}`);G(v,be);return}D(v,Ce,I,N)}else v.emit("unexpected-response",z,q)||Y(v,z,`Unexpected server response: ${q.statusCode}`)}),z.on("upgrade",(q,ee,ge)=>{if(v.emit("upgrade",q),v.readyState!==U.CONNECTING)return;if(z=v._req=null,q.headers.upgrade.toLowerCase()!=="websocket"){Y(v,ee,"Invalid Upgrade header");return}let Ce=e("sha1").update(M+s).digest("base64");if(q.headers["sec-websocket-accept"]!==Ce){Y(v,ee,"Invalid Sec-WebSocket-Accept header");return}let be=q.headers["sec-websocket-protocol"],ve;if(be!==void 0?he.size?he.has(be)||(ve="Server sent an invalid subprotocol"):ve="Server sent a subprotocol but none was requested":he.size&&(ve="Server sent no subprotocol"),ve){Y(v,ee,ve);return}be&&(v._protocol=be);let He=q.headers["sec-websocket-extensions"];if(He!==void 0){if(!W){Y(v,ee,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Ae;try{Ae=L(He)}catch{Y(v,ee,"Invalid Sec-WebSocket-Extensions header");return}let Ye=Object.keys(Ae);if(Ye.length!==1||Ye[0]!==o.extensionName){Y(v,ee,"Server indicated an extension that was not requested");return}try{W.accept(Ae[o.extensionName])}catch{Y(v,ee,"Invalid Sec-WebSocket-Extensions header");return}v._extensions[o.extensionName]=W}v.setSocket(ee,ge,{generateMask:O.generateMask,maxPayload:O.maxPayload,skipUTF8Validation:O.skipUTF8Validation})}),O.finishRequest?O.finishRequest(z,v):z.end()}function G(v,k){v._readyState=U.CLOSING,v.emit("error",k),v.emitClose()}function le(v){return v.path=v.socketPath,m.connect(v)}function H(v){return v.path=void 0,!v.servername&&v.servername!==""&&(v.servername=m.isIP(v.host)?"":v.host),r.connect(v)}function Y(v,k,I){v._readyState=U.CLOSING;let N=new Error(I);Error.captureStackTrace(N,Y),k.setHeader?(k[A]=!0,k.abort(),k.socket&&!k.socket.destroyed&&k.socket.destroy(),process.nextTick(G,v,N)):(k.destroy(N),k.once("error",v.emit.bind(v,"error")),k.once("close",v.emitClose.bind(v)))}function ce(v,k,I){if(k){let N=j(k).length;v._socket?v._sender._bufferedBytes+=N:v._bufferedAmount+=N}if(I){let N=new Error(`WebSocket is not open: readyState ${v.readyState} (${T[v.readyState]})`);process.nextTick(I,N)}}function Ue(v,k){let I=this[w];I._closeFrameReceived=!0,I._closeMessage=k,I._closeCode=v,I._socket[w]!==void 0&&(I._socket.removeListener("data",oe),process.nextTick(pe,I._socket),v===1005?I.close():I.close(v,k))}function Me(){let v=this[w];v.isPaused||v._socket.resume()}function we(v){let k=this[w];k._socket[w]!==void 0&&(k._socket.removeListener("data",oe),process.nextTick(pe,k._socket),k.close(v[p])),k.emit("error",v)}function xe(){this[w].emitClose()}function Se(v,k){this[w].emit("message",v,k)}function ke(v){let k=this[w];k.pong(v,!k._isServer,g),k.emit("ping",v)}function te(v){this[w].emit("pong",v)}function pe(v){v.resume()}function se(){let v=this[w];this.removeListener("close",se),this.removeListener("data",oe),this.removeListener("end",de),v._readyState=U.CLOSING;let k;!this._readableState.endEmitted&&!v._closeFrameReceived&&!v._receiver._writableState.errorEmitted&&(k=v._socket.read())!==null&&v._receiver.write(k),v._receiver.end(),this[w]=void 0,clearTimeout(v._closeTimer),v._receiver._writableState.finished||v._receiver._writableState.errorEmitted?v.emitClose():(v._receiver.on("error",xe),v._receiver.on("finish",xe))}function oe(v){this[w]._receiver.write(v)||this.pause()}function de(){let v=this[w];v._readyState=U.CLOSING,v._receiver.end(),this.end()}function fe(){let v=this[w];this.removeListener("error",fe),this.on("error",g),v&&(v._readyState=U.CLOSING,this.destroy())}}),Yt=F((d,a)=>{"use strict";var{tokenChars:y}=je();function f(x){let m=new Set,r=-1,h=-1,e=0;for(e;e<x.length;e++){let l=x.charCodeAt(e);if(h===-1&&y[l]===1)r===-1&&(r=e);else if(e!==0&&(l===32||l===9))h===-1&&r!==-1&&(h=e);else if(l===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${e}`);h===-1&&(h=e);let o=x.slice(r,h);if(m.has(o))throw new SyntaxError(`The "${o}" subprotocol is duplicated`);m.add(o),r=h=-1}else throw new SyntaxError(`Unexpected character at index ${e}`)}if(r===-1||h!==-1)throw new SyntaxError("Unexpected end of input");let i=x.slice(r,e);if(m.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return m.add(i),m}a.exports={parse:f}}),Jt=F((d,a)=>{"use strict";var y=require("events"),f=require("http"),x=require("https"),m=require("net"),r=require("tls"),{createHash:h}=require("crypto"),e=lt(),i=Ne(),l=Yt(),o=ct(),{GUID:c,kWebSocket:C}=ye(),_=/^[+/0-9A-Za-z]{22}==$/,t=0,s=1,S=2,u=class extends y{constructor(b,L){if(super(),b={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:o,...b},b.port==null&&!b.server&&!b.noServer||b.port!=null&&(b.server||b.noServer)||b.server&&b.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(b.port!=null?(this._server=f.createServer((j,B)=>{let A=f.STATUS_CODES[426];B.writeHead(426,{"Content-Length":A.length,"Content-Type":"text/plain"}),B.end(A)}),this._server.listen(b.port,b.host,b.backlog,L)):b.server&&(this._server=b.server),this._server){let j=this.emit.bind(this,"connection");this._removeListeners=p(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(B,A,P)=>{this.handleUpgrade(B,A,P,j)}})}b.perMessageDeflate===!0&&(b.perMessageDeflate={}),b.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=b,this._state=t}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(b){if(this._state===S){b&&this.once("close",()=>{b(new Error("The server is not running"))}),process.nextTick(w,this);return}if(b&&this.once("close",b),this._state!==s)if(this._state=s,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(w,this):process.nextTick(w,this);else{let L=this._server;this._removeListeners(),this._removeListeners=this._server=null,L.close(()=>{w(this)})}}shouldHandle(b){if(this.options.path){let L=b.url.indexOf("?");if((L!==-1?b.url.slice(0,L):b.url)!==this.options.path)return!1}return!0}handleUpgrade(b,L,j,B){L.on("error",g);let A=b.headers["sec-websocket-key"],P=+b.headers["sec-websocket-version"];if(b.method!=="GET"){E(this,b,L,405,"Invalid HTTP method");return}if(b.headers.upgrade.toLowerCase()!=="websocket"){E(this,b,L,400,"Invalid Upgrade header");return}if(!A||!_.test(A)){E(this,b,L,400,"Missing or invalid Sec-WebSocket-Key header");return}if(P!==8&&P!==13){E(this,b,L,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(b)){n(L,400);return}let T=b.headers["sec-websocket-protocol"],R=new Set;if(T!==void 0)try{R=l.parse(T)}catch{E(this,b,L,400,"Invalid Sec-WebSocket-Protocol header");return}let U=b.headers["sec-websocket-extensions"],D={};if(this.options.perMessageDeflate&&U!==void 0){let G=new i(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let le=e.parse(U);le[i.extensionName]&&(G.accept(le[i.extensionName]),D[i.extensionName]=G)}catch{E(this,b,L,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let G={origin:b.headers[`${P===8?"sec-websocket-origin":"origin"}`],secure:!!(b.socket.authorized||b.socket.encrypted),req:b};if(this.options.verifyClient.length===2){this.options.verifyClient(G,(le,H,Y,ce)=>{if(!le)return n(L,H||401,Y,ce);this.completeUpgrade(D,A,R,b,L,j,B)});return}if(!this.options.verifyClient(G))return n(L,401)}this.completeUpgrade(D,A,R,b,L,j,B)}completeUpgrade(b,L,j,B,A,P,T){if(!A.readable||!A.writable)return A.destroy();if(A[C])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>t)return n(A,503);let R=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${h("sha1").update(L+c).digest("base64")}`],U=new this.options.WebSocket(null);if(j.size){let D=this.options.handleProtocols?this.options.handleProtocols(j,B):j.values().next().value;D&&(R.push(`Sec-WebSocket-Protocol: ${D}`),U._protocol=D)}if(b[i.extensionName]){let D=b[i.extensionName].params,G=e.format({[i.extensionName]:[D]});R.push(`Sec-WebSocket-Extensions: ${G}`),U._extensions=b}this.emit("headers",R,B),A.write(R.concat(`\r
`).join(`\r
`)),A.removeListener("error",g),U.setSocket(A,P,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(U),U.on("close",()=>{this.clients.delete(U),this._shouldEmitClose&&!this.clients.size&&process.nextTick(w,this)})),T(U,B)}};a.exports=u;function p(b,L){for(let j of Object.keys(L))b.on(j,L[j]);return function(){for(let j of Object.keys(L))b.removeListener(j,L[j])}}function w(b){b._state=S,b.emit("close")}function g(){this.destroy()}function n(b,L,j,B){j=j||f.STATUS_CODES[L],B={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(j),...B},b.once("finish",b.destroy),b.end(`HTTP/1.1 ${L} ${f.STATUS_CODES[L]}\r
`+Object.keys(B).map(A=>`${A}: ${B[A]}`).join(`\r
`)+`\r
\r
`+j)}function E(b,L,j,B,A){if(b.listenerCount("wsClientError")){let P=new Error(A);Error.captureStackTrace(P,E),b.emit("wsClientError",P,j,L)}else n(j,B,A)}}),ht={};At(ht,{chronocat:()=>$i});bt.exports=Rt(ht);var Xe=ne(ot()),Xt=require("electron"),Zt=d=>new Promise(a=>setTimeout(a,d)),Oe={},Re={},Be={},Pe=[],We={},pt={},ue={},dt={},Te={},ft={},Qt=()=>{let d=new Date().getTime();return d+=performance.now(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let y=(d+Math.random()*16)%16|0;return d=Math.floor(d/16),(a==="x"?y:y&3|8).toString(16)})},ei=async(d,a,...y)=>{let f=Qt(),x=await Promise.race([new Promise((m,r)=>setTimeout(()=>r(),1e4)),new Promise(m=>{Oe[f]=m,Xt.ipcMain.emit(d,{sender:{send:(...r)=>{m(r)},__CHRONO_HOOKED__:!0}},{type:"request",callbackId:f,eventName:a},y)})]);return delete Oe[f],x};function X(d,a,y){return(...f)=>ei(d,a,y,...f)}var ti=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/getMemberInfo"),ut=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/createMemberListScene"),ii=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/searchMember"),ze=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/destroyMemberListScene"),ri=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/getNextMemberList"),si=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/setMemberShutUp"),oi=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/setGroupShutUp"),ai=X("IPC_UP_2","ns-ntApi-2","nodeIKernelGroupService/kickMember"),De=require("electron"),ni=d=>{let a=De.ipcMain.emit;return De.ipcMain.emit=function(y,...f){let x=f[0],m=f?.[1],r=f?.[2],h=x.sender;if(!h.__CHRONO_HOOKED__){let i=h.send;h.__CHRONO_HOOKED__=!0,h.send=function(l,o,c){if(d({Full:[l,o,c],EventName:o.eventName,CmdName:c?.[0]?.cmdName,Payload:c?.[0]?.payload,Request:Be[o.callbackId]}),i.call(this,l,o,c),o.callbackId){let C=o.callbackId;Oe[C]&&Oe[C]?.call(o,c),Re[o.callbackId]&&(Re[o.callbackId].resolved=c)}delete Be[o.callbackId]}}let e={Full:f,EventName:m?.eventName,Method:r?.[0],Args:r,Channel:y};return a.call(this,y,...f),m?.eventName?.includes("Log")||(Re[m?.callbackId]??={},Be[m?.callbackId]=e),!1},()=>{De.ipcMain.emit=a}},li={body:"none",httpOnly:!1,requireAuthorize:!0},mt=[],Fe=(d,a)=>new Proxy(()=>{},{get(y,f){if(typeof f=="symbol")throw Error("Symbol is not supported");return f.startsWith("$")?x=>Fe(d,{...a,[f.slice(1)]:x}):Fe([...d,f],a)},set(y,f,x,m){throw Error("Cannot set property on router")},apply(y,f,[x,m]){mt.push({path:d,options:{...a,...m},handler:x})}}),re=Fe([],li),Ze=d=>mt.find(a=>!a.path.some((y,f)=>y!==d[f]));re.bot.friends(async()=>Object.values(dt));re.bot.groups(async()=>Object.values(pt));re.getSelfProfile(async()=>ft.value??{});var Ke=d=>{};re.group.getMemberList.$body("json")(async({body:d})=>{let{group:a,size:y}=d,f=await ut({groupCode:a,scene:"groupMemberList_MainWindow"}),x=await ri({sceneId:f,lastId:void 0,num:y});return await ze({sceneId:f}),Ke(ze({sceneId:f})),x.result?.ids?.map(({uid:m,index:r})=>({uid:m,index:r,detail:x.result.infos.get(m)}))});var ci=ne(Bt()),hi=class{#e={};get(d,a){a(this.#e[d])}set(d,a,y){this.#e[d]=a,y()}clear(d){this.#e={},d()}};function pi(d){let a=Math.floor(Math.random()*1e8).toString(36),y=new hi;function f(){return function(...x){let m=this,r=x.slice(),h=r.pop(),e=a+"="+(0,ci.default)(r);y.get(e,function(i){if(i&&(!i.expires||i.expires>=Date.now()))return h.apply(m,i.args);r.push(function(...l){let o=this,c=l.slice();y.set(e,{args:c,expires:Date.now()+3e4},function(){h.apply(o,c)})}),d.apply(d,r)})}}return f()}var _e={},_t=d=>{let a=[],y=f=>{for(let x in f)f[x]instanceof Map||(f[x]instanceof Object?y(f[x]):a.push([x,f[x],f]))};return y(d),a},$e=d=>{let a={uid:"uin",uin:"uid",Uid:"Uin",Uin:"Uid"};for(let y in a)if(d.endsWith(y))return d.slice(0,-y.length)+a[y]},yt=(d,a)=>{parseInt(d)===0||parseInt(a)===0||(_e[d]=a,_e[a]=d)},Qe=pi(async d=>{let a=await ut({groupCode:d,scene:"groupMemberList_MainWindow"});Ke(ii({sceneId:a,keyword:d})),await ze({sceneId:a})}),di=d=>{for(let[a,y,f]of _t(d)){let x=$e(a);if(x&&f[x]){if(parseInt(f[x])==0||!f[x]||f[x].includes("*")||_e[y])continue;yt(y,f[x])}}},fi=async(d,{contextGroup:a=-1}={})=>{let y=_t(d);for(let[f,x,m]of y){let r=$e(f);r&&!m[r]&&(f.toLocaleLowerCase().endsWith("uin")&&a!==-1&&Qe(a,x),f==="atNtUid"&&Qe(a,m.content.slice(1)))}await Zt(80);for(let[f,x,m]of y){let r=$e(f);f==="peerUin"&&m.chatType===2&&(m.peerUid=x),f==="peerUid"&&!x.startsWith("u_")&&(m.peerUin=x),r&&!m[r]&&_e[x]&&(m[r]=_e[x])}return d},ui=d=>d.map(a=>_e[a]??a),ie={cacheObject:di,preprocessObject:fi,addToMap:yt,preprocessArrayOfUix:ui,map:_e};re.group.kick.$body("json")(async({body:d})=>{let{uidList:a,group:y,reason:f,refuseForever:x}=d;return await ai({groupCode:y,kickUids:ie.preprocessArrayOfUix(a),refuseForever:x,kickReason:f})});re.group.muteEveryone.$body("json")(async({body:d})=>{let{group:a,enable:y}=d;return await oi({groupCode:a,shutUp:y})});re.group.muteMember.$body("json")(async({body:d})=>{let{group:a,memList:y}=d;return await si({groupCode:a,memList:await ie.preprocessObject(y,{contextGroup:Number(a)})})});var mi=ne(qt()),_i=require("node:fs"),yi=X("IPC_UP_2","ns-ntApi-2","nodeIKernelMsgService/recallMsg"),gi=X("IPC_UP_2","ns-ntApi-2","nodeIKernelMsgService/downloadRichMedia"),bi=X("IPC_UP_2","ns-ntApi-2","nodeIKernelMsgService/getMsgsIncludeSelf"),xi=X("IPC_UP_2","ns-ntApi-2","nodeIKernelMsgService/getRichMediaFilePath"),vi=X("IPC_UP_2","ns-ntApi-2","nodeIKernelMsgService/sendMsg");re.message.fetchRichMedia.$body("json").$httpOnly(!0)(async({body:d,http:a})=>{let{msgId:y,elementId:f,chatType:x,peerUid:m}=d,r=y+"::"+f;console.log("DownloadId:",r);let h=new Promise(l=>{Te[r]=l});x===1&&!m.startsWith("u_")&&(m=ie.map[m]),await gi({getReq:{msgId:y,chatType:x,peerUid:m,elementId:f,thumbSize:0,downloadType:2}});let e=await h;a.res.statusCode=200,a.res.setHeader("Content-Type",(0,mi.getType)(e));let i=(0,_i.createReadStream)(e);await new Promise((l,o)=>i.pipe(a.res).on("finish",l).on("error",o)),a.res.end()});re.message.getHistory.$body("json")(async({body:d})=>{let{peer:a,offsetMsgId:y,count:f}=d;return await bi({peer:await ie.preprocessObject(a),msgId:y,cnt:f,queryOrder:!0})});re.message.recall.$body("json")(async({body:d})=>{let{peer:a,msgIds:y}=d;return yi({peer:await ie.preprocessObject(a),msgIds:y})});var et=ne(ot()),gt=d=>"peer"in d?!d.elements.some(a=>a.walletElement||a.arkElement):!(d.msgType===et.MsgType.Ark||d.msgType===et.MsgType.Wallet),tt={atTinyUid:"",elementId:"",msgId:"0",chatType:1,guildId:"",peerUid:"",peerUin:"",elementType:1,content:"",atUid:"",atNtUid:"",atType:0,extBufForUI:"",fileName:"",fileSize:"",fileSubId:"",fileUuid:"",md5HexStr:"",original:!0,picHeight:0,picWidth:0,picType:0,picSubType:0,sourcePath:"",summary:"",thumbFileSize:0},wi=d=>{let a=y=>{for(let f in y)if(typeof y[f]=="object"&&y[f]!==null)a(y[f]);else for(let x in tt)y[x]??=tt[x]};return a(d),d};re.message.send.$body("json")(async({body:d})=>{let a=d;if(!gt(a))return{};wi(a);let y={msgId:"0",peer:await ie.preprocessObject(a.peer),msgElements:await ie.preprocessObject(a.elements,{contextGroup:a.peer.chatType===2?Number(a.peer.peerUin):void 0})};return await new Promise((f,x)=>{Pe.push(f),Ke(vi(y)),setTimeout(()=>{let m=Pe.indexOf(f);m>=0&&(Pe.splice(m,1),x())},1e4)})});var Si=ne(Vt()),ki=require("node:crypto"),Ci=require("node:fs"),it=require("node:fs/promises"),rt=require("node:path"),Ei=X("IPC_UP_2","ns-fsApi-2","getFileMd5"),Pi=X("IPC_UP_2","ns-fsApi-2","getImageSizeFromPath"),Ti=X("IPC_UP_2","ns-fsApi-2","getFileSize"),Oi=X("IPC_UP_2","ns-fsApi-2","getFileType"),Ii=require("node:os"),Li=require("node:path"),Ve=(0,Li.join)(process.env.APPDATA||(0,Ii.homedir)(),"BetterUniverse/QQNT");re.upload.$httpOnly("POST")(({http:{req:d,res:a}})=>new Promise((y,f)=>{let x=(0,Si.default)({headers:d.headers}),m;x.on("error",f),x.on("file",(r,h,e)=>{m=(async()=>{let i=(0,rt.join)(Ve,"redprotocol-upload");await(0,it.mkdir)(i,{recursive:!0});let l=(0,rt.join)(i,`${(0,ki.randomFillSync)(Buffer.alloc(16)).toString("hex")}-${e.filename}`);return await new Promise((o,c)=>h.pipe((0,Ci.createWriteStream)(l)).on("finish",()=>o({filePath:l,fileInfo:e})).on("error",c))})()}),x.on("close",async()=>{if(!m){a.writeHead(400),a.end("400 bad request");return}let{filePath:r,fileInfo:h}=await m,e=(await Oi(r)).mime.split("/")[0],[i,l,o]=await Promise.all([Ei(r),e==="image"?Pi(r):void 0,Ti(r)]),c=await xi({md5HexStr:i,fileName:h.filename,elementType:2,elementSubType:0,thumbSize:0,needCreate:!0,fileType:1});await(0,it.copyFile)(r,c),y({md5:i,imageInfo:l,fileSize:o,filePath:r,ntFilePath:c})}),d.pipe(x)}));var Ni=d=>a=>a.headers.authorization?.slice(0,7)==="Bearer "&&a.headers.authorization.slice(7)===d,ji=d=>a=>a.token===d,Ui=require("node:http"),Mi=class{constructor(d,{authorizer:a,rootPath:y="/api/",port:f}){this.server=(0,Ui.createServer)(async(x,m)=>{if(!x.url){m.writeHead(400),m.end("404 bad request");return}let r=new URL(x.url,`http://${x.headers.host}`);if(!r.pathname.startsWith(y)){m.writeHead(404),m.end("404 not found");return}let h=r.pathname.slice(y.length).split("/").filter(i=>i),e=d(h);if(e)try{e.options.requireAuthorize&&!await a(x)&&(m.writeHead(401),m.end("401 unauthorized"));let i=_=>{let t=[];return new Promise((s,S)=>{_.on("data",u=>{t.push(u)}),_.on("end",()=>{s(Buffer.concat(t))}),_.on("error",()=>{S()})})},l=async _=>(await i(_)).toString("utf-8"),o;e.options.body==="binary"?o=await i(x):e.options.body==="json"?o=JSON.parse(await l(x)):e.options.body==="text"&&(o=await l(x));let c={http:e.options.httpOnly&&{req:x,res:m},body:o},C=await e.handler(c);m.writableEnded||(m.setHeader("Content-Type","application/json"),m.writeHead(200),m.end(JSON.stringify(C)))}catch(i){console.log(i),m.writeHead(500),m.end("500 internal server error")}else m.writeHead(404),m.end("404 not found")}),this.server.listen(f)}server;stop(){this.server.close()}},Ai={createServer:(d,a)=>new Mi(d,a)},Hi=ne(Gt(),1),Yi=ne(at(),1),Ji=ne(nt(),1),Xi=ne(ct(),1),Ri=ne(Jt(),1),Bi=class{constructor(d,{authorizer:a,rootPath:y="/",mountHTTPServer:f,port:x,connectPayload:m}){this.server=new Ri.default({server:f,port:x,path:y}),this.server.on("connection",async r=>{r.once("message",async h=>{try{let e=JSON.parse(h.toString()),{type:i,payload:l}=e;if(i==="meta::connect"){if(!await a(l)){r.close(401);return}this.wsAuthedClients.push(r),r.on("message",async o=>{let c=JSON.parse(o.toString());if(typeof i!="string")return;let C=c.type.split("::"),_=d(C);await this.handleRoute(_,r,c)}),r.on("disconnect",()=>this.wsAuthedClients.splice(this.wsAuthedClients.indexOf(r),1)),r.send(JSON.stringify({type:"meta::connect",payload:m()}))}else if(typeof i=="string"){let o=i.split("::"),c=d(o);if(c.options.requireAuthorize)throw Error("Authorize needed");await this.handleRoute(c,r,e)}else throw new Error("Invalid API type")}catch{r.close(401)}})})}server;wsAuthedClients=[];async handleRoute(d,a,y){let f=x=>a.send(JSON.stringify({type:`${d.path.join("::")}::reply`,payload:x,echo:y.echo}));if(d){let{payload:x}=y;if(d.options.httpOnly)return f({error:"route not supported",reason:"This route is http only"});if(d.options.body==="binary")return f({error:"route not supported",reason:"Binary body is not supported for websocket"});if(d.options.body==="json"&&typeof x!="object")return f({error:"invalid payload",reason:"Payload must be an object for this route"});if(d.options.body==="text"&&typeof x!="string")return f({error:"invalid payload",reason:"Payload must be a string for this route"});let m={body:x,http:void 0};try{let r=await d.handler(m);f(r)}catch(r){console.error(r),f({error:"internal error",reason:"Internal error occurred"})}}else f({error:"route error",reason:"Route not found"})}broadcast(d,a){this.wsAuthedClients.forEach(y=>y.send(JSON.stringify({type:d,payload:a})))}stop(){this.server.close()}},Wi={createServer:(d,a)=>new Bi(d,a)},Di=(d,a)=>{let y=Ai.createServer(Ze,{authorizer:Ni(d),rootPath:"/api/",port:16530}),f=Wi.createServer(Ze,{authorizer:ji(d),rootPath:"/",mountHTTPServer:y.server,connectPayload:a});return{binaryServer:y,broadcastAbleServer:f}},qi=require("node:crypto"),qe=require("node:fs/promises"),zi=require("node:path"),Fi=async()=>{let d=(0,zi.join)(Ve,"RED_PROTOCOL_TOKEN");try{return(await(0,qe.readFile)(d,"utf-8")).trim()}catch{}let a=(0,qi.randomBytes)(32).toString("hex");return await(0,qe.mkdir)(Ve,{recursive:!0}),await(0,qe.writeFile)(d,a),a},$i=async()=>{let d=await Fi(),{broadcastAbleServer:a,binaryServer:y}=Di(d,()=>({version:"0.0.39",name:"chronocat",authData})),f=(m,r)=>a.broadcast(m,r),x=ni(async({CmdName:m,Payload:r})=>{try{ie.cacheObject(r)}catch{}switch(m){case"nodeIKernelMsgListener/onRecvMsg":{let h=r,e=async l=>{l.chatType===Xe.ChatType.Group&&await ti({forceUpdate:!1,groupCode:+l.peerUid,uids:[l.senderUid]})},i=l=>{l.chatType===Xe.ChatType.Group&&(l.roleType=ue[l.peerUid]?.[l.senderUid])};f("message::recv",await Promise.all(h.msgList.filter(gt).map(async l=>(await e(l),l=await ie.preprocessObject(l),i(l),l))));return}case"nodeIKernelProfileListener/onProfileSimpleChanged":case"nodeIKernelGroupListener/onSearchMemberChange":case"nodeIKernelGroupService/getNextMemberList":{let h=r;h.profiles.get(authData.uid)&&(ft.value=h.profiles.get(authData.uid));let e=h.profiles??h.infos;for(let[i,{uin:l}]of e)ie.addToMap(i,l);return}case"nodeIKernelGroupListener/onMemberInfoChange":{let{groupCode:h,members:e}=r;for(let[i,{uin:l,role:o}]of e)ie.addToMap(i,l),h in ue||(ue[h]={}),ue[h][i]=o;break}case"nodeIKernelGroupListener/onMemberListChange":{let h=r,e=h.info.sceneId.split("_")[0];if(!e)break;for(let[i,{uin:l,role:o}]of h.info.infos)ie.addToMap(i,l),e in ue||(ue[e]={}),ue[e][i]=o;break}case"nodeIKernelMsgListener/onRichMediaDownloadComplete":{let h=r,e=`${h.notifyInfo.msgId}::${h.notifyInfo.msgElementId}`;Te[e]&&(Te[e](h.notifyInfo.filePath),delete Te[e]);return}case"nodeIKernelGroupListener/onGroupListUpdate":{let h=r;for(let e of h.groupList)pt[e.groupCode]=e;return}case"nodeIKernelBuddyListener/onBuddyListChange":{let h=r;for(let e of h.data)for(let i of e.buddyList)i.category=e.categoryName,dt[i.uin]=i;return}case"nodeIKernelMsgListener/onAddSendMsg":{let{msgRecord:h}=r;We[h.msgId]=Pe.shift();return}case"nodeIKernelMsgListener/onMsgInfoListUpdate":{let{msgList:h}=r;for(let e of h)e.sendStatus>1&&(We[e.msgId]?.(e),delete We[e.msgId]);return}}});return()=>{x(),y.stop(),a.stop()}}});var Gi={};Tt(Gi,{onLoad:()=>Vi});module.exports=It(Gi);var vt=Ot(xt()),Vi=()=>(0,vt.chronocat)();0&&(module.exports={onLoad});
//# sourceMappingURL=index.js.map
